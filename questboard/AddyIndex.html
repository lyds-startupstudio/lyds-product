<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Addy - Gamified Team Management</title>
    <link rel="stylesheet" href="AddyStyle.css">
</head>
<body>
  <!-- Sign Up Screen - FIRST SCREEN -->
  <div id="signupScreen" class="screen active">
    <div class="setup-container">
      <div class="setup-header">
        <div class="setup-topbar">
          <button id="haveAccountBtn" class="btn btn-secondary btn-auth">Already have an account? Sign In</button>
        </div>
        <h1 class="setup-title">Create Your Account</h1>
        <p class="setup-subtitle">Get started with Addy</p>
      </div>
      
      <div class="setup-content" style="justify-content:center;">
        <div style="max-width:400px;width:100%;margin:0 auto;">
          <div style="margin-bottom:16px;padding:12px;background:#f0f9ff;border-radius:8px;font-size:13px;">
            Create your account to start using Addy
          </div>
          
          <form id="initialSignupForm">
            <div class="form-group">
              <label class="form-label">Email</label>
              <input id="signupEmail" type="email" class="form-control" placeholder="you@example.com" required>
            </div>
            <div class="form-group">
              <label class="form-label">Password</label>
              <input id="signupPassword" type="password" class="form-control" placeholder="Choose a strong password (min 8 characters)" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width:100%;margin-top:16px;">Create Account & Continue</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Setup Screen -->
  <div id="setupScreen" class="screen">
    <div class="setup-container">
      <div class="setup-header">
        <div class="setup-topbar">
          <button id="globalSignInBtn" class="btn btn-secondary btn-auth">Sign In</button>
        </div>
        <div class="setup-logo">Addy</div>
        <h1 class="setup-title">Setup Your Workspace</h1>
        <p class="setup-subtitle">Let's customize your workspace</p>
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      </div>
      
      <div class="setup-content">
        <!-- Step 1 -->
        <div class="step active" id="step1">
          <h2 class="step-title">Who will be using this?</h2>
          <div class="option-grid">
            <div class="option-card" onclick="selectOption('userType','personal',this)">
              <span class="option-icon">üë§</span>
              <h3 class="option-title">Personal Use</h3>
              <p class="option-description">Manage your own tasks, projects, and personal goals</p>
            </div>
            <div class="option-card" onclick="selectOption('userType','business',this)">
              <span class="option-icon">üë•</span>
              <h3 class="option-title">Business/Team</h3>
              <p class="option-description">Manage team tasks, collaborate with colleagues</p>
            </div>
          </div>
        </div>

        <!-- Step 2A -->
        <div class="step" id="step2a">
          <h2 class="step-title">What type of business are you?</h2>
          <div class="option-grid">
            <div class="option-card" onclick="selectOption('businessType','tech',this)"><span class="option-icon">üíª</span><h3 class="option-title">Tech Company</h3></div>
            <div class="option-card" onclick="selectOption('businessType','retail',this)"><span class="option-icon">üõí</span><h3 class="option-title">Retail/E-commerce</h3></div>
            <div class="option-card" onclick="selectOption('businessType','hospitality',this)"><span class="option-icon">üè®</span><h3 class="option-title">Hospitality</h3></div>
            <div class="option-card" onclick="selectOption('businessType','professional',this)"><span class="option-icon">üíº</span><h3 class="option-title">Professional Services</h3></div>
            <div class="option-card" onclick="selectOption('businessType','creative',this)"><span class="option-icon">üé®</span><h3 class="option-title">Creative Industry</h3></div>
            <div class="option-card" onclick="selectOption('businessType','other',this)"><span class="option-icon">üìã</span><h3 class="option-title">Other</h3></div>
          </div>
        </div>

        <!-- Step 2B -->
        <div class="step" id="step2b">
          <h2 class="step-title">What's your main goal?</h2>
          <div class="option-grid">
            <div class="option-card" onclick="selectOption('personalPurpose','productivity',this)"><span class="option-icon">üìà</span><h3 class="option-title">Personal Productivity</h3></div>
            <div class="option-card" onclick="selectOption('personalPurpose','study',this)"><span class="option-icon">üìö</span><h3 class="option-title">Study & Learning</h3></div>
            <div class="option-card" onclick="selectOption('personalPurpose','freelance',this)"><span class="option-icon">üíª</span><h3 class="option-title">Freelance Work</h3></div>
            <div class="option-card" onclick="selectOption('personalPurpose','creative',this)"><span class="option-icon">üé®</span><h3 class="option-title">Creative Projects</h3></div>
          </div>
        </div>

        <!-- Step 3A -->
        <div class="step" id="step3a">
          <h2 class="step-title">What teams or departments do you have?</h2>
          <div class="form-group">
            <label class="form-label">Add your teams</label>
            <div class="tag-input-container" onclick="focusTagInput()">
              <div id="teamTags"></div>
              <input id="teamInput" class="tag-input" type="text" placeholder="Type team name and press Enter" onkeypress="handleTeamInput(event)">
            </div>
          </div>
        </div>

        <!-- Step 3B -->
        <div class="step" id="step3b">
          <h2 class="step-title">What categories of tasks do you want to manage?</h2>
          <div class="form-group">
            <label class="form-label">Add your task categories</label>
            <div class="tag-input-container" onclick="focusTagInput()">
              <div id="categoryTags"></div>
              <input id="categoryInput" class="tag-input" type="text" placeholder="Type category name and press Enter" onkeypress="handleCategoryInput(event)">
            </div>
          </div>
        </div>
      </div>

      <div class="button-group">
        <button id="prevBtn" class="btn btn-secondary" onclick="previousStep()" style="display:none;">Previous</button>
        <div></div>
        <button id="nextBtn" class="btn btn-primary" onclick="nextStep()" disabled>Next</button>
      </div>
    </div>
  </div>

  <!-- Avatar Creation - TWO STEPS -->
  <div id="avatarScreen" class="screen">
    <div class="avatar-creation-container">
      <div class="avatar-card">
        <button type="button" class="back-link" id="avatarBackBtn">‚Üê Back</button>
        
        <!-- STEP 1: Basic Info + Avatar Selection -->
        <div id="avatarStep1" class="avatar-step">
          <h1 class="avatar-title">Create Your Avatar</h1>
          
          <form id="avatarStep1Form" class="avatar-form">
            <div class="form-group">
              <label class="form-label">Your Name</label>
              <input id="userName" class="form-control" placeholder="Enter your name" required>
            </div>
            <div class="form-group">
              <label class="form-label">Job Title</label>
              <input id="jobTitle" class="form-control" placeholder="Enter your role" required>
            </div>

            <div class="form-group" id="teamSelectionGroup" style="display:none;">
              <label class="form-label">Select Your Team</label>
              <select id="userTeam" class="form-control">
                <option value="">Select your team</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Choose Your Avatar</label>
              <div id="avatarGrid" class="avatar-grid"></div>
            </div>

            <div class="avatar-actions">
              <button type="button" class="btn btn-secondary" id="cancelAvatarBtn">Cancel</button>
              <button type="submit" class="btn btn-primary">Next</button>
            </div>
          </form>
        </div>

        <!-- STEP 2: Employee Credentials (Business Only) -->
        <div id="avatarStep2" class="avatar-step" style="display:none;">
          <h1 class="avatar-title">Employee Login Credentials</h1>
          
          <form id="avatarStep2Form" class="avatar-form">
            <div style="margin-bottom:16px;padding:12px;background:#f0f9ff;border-radius:8px;font-size:13px;">
              Set up login credentials for this employee
            </div>
            
            <div class="form-group">
              <label class="form-label">Employee Email</label>
              <input id="avatarEmail" type="email" class="form-control" placeholder="employee@company.com" required>
            </div>
            <div class="form-group">
              <label class="form-label">Password</label>
              <input id="avatarPassword" type="password" class="form-control" placeholder="Choose a password (min 8 characters)" required>
            </div>
            <div class="form-group">
              <label class="form-label">Internal Username (optional)</label>
              <input id="avatarUsername" class="form-control" placeholder="e.g., john.doe">
            </div>

            <div class="avatar-actions">
              <button type="button" class="btn btn-secondary" id="backToStep1Btn">‚Üê Back</button>
              <button type="submit" class="btn btn--primary quest-button">
                <span>Create Employee</span>
                <div class="button-shine"></div>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Platform -->
  <div id="platformScreen" class="screen">
    <div class="platform-container">
      <header class="top-nav">
        <div class="nav-left">
          <button id="backToPlatform" class="btn-icon" style="display:none;" title="Back">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
          </button>
          <div class="logo">Addy</div>
        </div>
        
        <div class="nav-center">
          <div class="user-info">
            <div id="navUserAvatar" class="user-avatar-nav"></div>
            <div class="user-details">
              <div id="navUserName" class="user-name"></div>
              <div id="navUserRole" class="user-role"></div>
            </div>
          </div>
        </div>
        
        <div class="nav-right">
          <button type="button" id="customizeBtn" class="btn btn-secondary" style="margin-right: 8px;">üé® Customize</button>
          <button type="button" id="signOutBtn" class="btn btn-secondary">Sign Out</button>
        </div>
      </header>

      <div id="officeLayout" class="office-layout">
        <div id="officeMap" class="office-map">
          <div id="userCharacter" class="user-character">
            <div class="character-avatar"></div>
            <div class="character-name"></div>
          </div>
          <div id="teamRoomsContainer"></div>
        </div>
        
        <div class="game-instructions">
          <div class="instruction">Use ‚Üë‚Üì‚Üê‚Üí or WASD to move</div>
          <div class="instruction">Go near a team room and press E to enter</div>
        </div>
      </div>

      <aside id="sidePanel" class="side-panel">
        <div class="side-section">
          <div class="section-title">üìÖ Company Events</div>
          <button id="addCompanyEventBtn" class="btn btn-primary btn-sm" style="width:100%;margin-bottom:8px;">+ Add Event</button>
          <div id="sidebarCompanyEvents" class="sidebar-list"></div>
        </div>
        
        <div class="side-section">
          <div class="section-title">Teams - Leaderboard</div>
          <div id="sidebarTeamList" class="sidebar-list"></div>
        </div>
        
        <div class="side-section">
          <div class="section-title">Employees</div>
          <input id="employeeSearch" class="form-control form-control--sm" placeholder="Search employee...">
          <div id="sidebarEmployeeList" class="sidebar-list"></div>
        </div>
      </aside>

      <div class="office-action-buttons">
        <button type="button" id="employeeSignInBtn" class="btn btn-secondary">Employee Sign In</button>
        <button type="button" id="signOutEmployeeBtn" class="btn btn-secondary" style="display:none;">Sign Out Employee</button>
        <button type="button" id="createNewAvatarBtn" class="btn btn-secondary">Create New Avatar</button>
        <button type="button" id="createTeamBtn" class="btn btn-secondary">Create Team</button>
      </div>
    </div>
  </div>

  <!-- Team Screen -->
  <div id="teamScreen" class="screen">
    <div class="team-container">

      <header class="team-header">
        <button type="button" id="backButton" class="back-button">‚Üê Back to Office</button>
        <div class="team-info">
          <h2 id="teamName" class="team-title"></h2>
          <div id="teamLeadInfo" style="margin-bottom:8px;"></div>
          <div id="teamMembersList" class="team-members"></div>
        </div>

        <div class="team-actions">
          <button type="button" id="managePermsBtn" class="btn btn-secondary btn-sm">Manage Permissions</button>
          <button type="button" id="addTaskHeaderBtn" class="add-task-header-btn">+ Add Task</button>
          
          <div style="margin-top:16px;padding:12px;background:#f8f9ff;border-radius:8px;border:1px solid #e5e7eb;">
            <div class="section-title" style="margin:0 0 8px 0;">üìÖ Team Events</div>
            <button type="button" id="teamEventsBtn" class="btn btn-primary btn-sm" style="width:100%;margin-bottom:8px;">+ Add Event</button>
            <div id="teamEventsSection"></div>
          </div>
        </div>
      </header>

      <section class="backlog-belt">
        <div class="belt-header">
          <div class="belt-left">
            <span class="belt-title">üìã Backlog</span>
            <span class="belt-hint">Drag from here to assign ‚Üí</span>
          </div>
          <div class="belt-right">
            <button type="button" id="beltToggle" class="btn btn-secondary btn-sm">Pause</button>
            <span class="belt-count" id="backlogCount">0</span>
          </div>
        </div>
        <div id="backlogBeltViewport" class="belt-viewport" data-paused="false">
          <div id="backlogBeltTrack" class="belt-track"></div>
        </div>
      </section>

      <div class="kanban-board">
        <div class="kanban-column todo-column">
          <div class="column-header todo-header">
            <div class="column-left"><span class="column-title">TODO</span></div>
            <div class="column-right">
              <button class="add-task-column-btn" onclick="showAddTaskToColumnModal('todo')">+</button>
              <span id="todoCount" class="column-count">0</span>
            </div>
          </div>
          <div id="todoTasks" class="column-content" data-status="todo"></div>
        </div>

        <div class="kanban-column progress-column">
          <div class="column-header progress-header">
            <div class="column-left"><span class="column-title">In Progress</span></div>
            <div class="column-right">
              <button class="add-task-column-btn" onclick="showAddTaskToColumnModal('in-progress')">+</button>
              <span id="progressCount" class="column-count">0</span>
            </div>
          </div>
          <div id="progressTasks" class="column-content" data-status="in-progress"></div>
        </div>

        <div class="kanban-column waiting-column">
          <div class="column-header waiting-header">
            <div class="column-left"><span class="column-title">Waiting</span></div>
            <div class="column-right">
              <button class="add-task-column-btn" onclick="showAddTaskToColumnModal('waiting')">+</button>
              <span id="waitingCount" class="column-count">0</span>
            </div>
          </div>
          <div id="waitingTasks" class="column-content" data-status="waiting"></div>
        </div>

        <div class="kanban-column done-column">
          <div class="column-header done-header">
            <div class="column-left"><span class="column-title">Done</span></div>
            <div class="column-right">
              <button class="add-task-column-btn" onclick="showAddTaskToColumnModal('done')">+</button>
              <span id="doneCount" class="column-count">0</span>
            </div>
          </div>
          <div id="doneTasks" class="column-content" data-status="done"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Customization Store Screen -->
  <div class="screen" id="customizationScreen">
    <div class="customization-container">
      <!-- Header with user stats -->
      <header class="customization-header">
        <div class="header-content">
          <button class="back-to-platform-btn" id="backToPlatformBtn">
            ‚Üê Back to Workspace
          </button>
          <h1 class="store-title">‚ú® Your Personal Encouragement Store</h1>
          <div class="motivational-quote" id="motivationalQuote">
            "You're capable of amazing things!"
          </div>
          <div class="user-stats">
            <div class="stat-item">
              <span class="stat-label">Level</span>
              <span class="stat-value level-display" id="storeUserLevel">1</span>
              <span class="level-title" id="storeLevelTitle">Getting Started</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Coins</span>
              <span class="stat-value coins-display" id="storeUserCoins">100</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Points</span>
              <span class="stat-value points-display" id="storeUserPoints">0</span>
            </div>
          </div>
        </div>
        <div class="progress-section">
          <div class="progress-info">
            <span class="progress-text">Your Growth Journey</span>
            <span class="progress-numbers" id="storeProgressNumbers">0 / 100</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="storeProgressFill"></div>
          </div>
        </div>
      </header>

      <!-- Department Navigation -->
      <nav class="department-nav">
        <div class="department-buttons">
          <button class="department-btn active" id="avatarDepartmentBtn" data-department="avatars">
            üé≠ Avatar Store
          </button>
          <button class="department-btn" id="themeDepartmentBtn" data-department="themes">
            üé® Workspace Themes
          </button>
          <button class="department-btn" id="inventoryDepartmentBtn" data-department="inventory">
            üì¶ My Collection
          </button>
        </div>
      </nav>

      <!-- Store Content -->
      <main class="store-content">
        <!-- Avatar Store Department -->
        <div class="department active" id="avatarDepartment">
          <div class="department-header">
            <h2>Choose Your Avatar</h2>
            <p>Express yourself with encouraging emojis that motivate and inspire!</p>
          </div>
          
          <div class="category-filters" id="avatarCategoryFilters">
            <!-- Will be populated by JavaScript -->
          </div>

          <div class="items-grid" id="avatarItemsGrid">
            <!-- Avatar items will be populated by JavaScript -->
          </div>
        </div>

        <!-- Theme Store Department -->
        <div class="department" id="themeDepartment">
          <div class="department-header">
            <h2>Workspace Themes</h2>
            <p>Transform your Addy workspace with beautiful, inspiring themes!</p>
          </div>
          
          <div class="items-grid" id="themeItemsGrid">
            <!-- Theme items will be populated by JavaScript -->
          </div>
        </div>

        <!-- Inventory Department -->
        <div class="department" id="inventoryDepartment">
          <div class="department-header">
            <h2>My Collection</h2>
            <p>Manage your avatars and themes</p>
          </div>

          <div class="inventory-sections">
            <div class="inventory-section">
              <h3>My Avatars</h3>
              <div class="current-selection" id="currentAvatarSelection">
                <!-- Current avatar display -->
              </div>
              <div class="owned-items" id="ownedAvatars">
                <!-- Owned avatars -->
              </div>
            </div>

            <div class="inventory-section">
              <h3>My Themes</h3>
              <div class="current-selection" id="currentThemeSelection">
                <!-- Current theme display -->
              </div>
              <div class="owned-items" id="ownedThemes">
                <!-- Owned themes -->
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Purchase Modal -->
    <div class="modal-overlay" id="purchaseModalOverlay">
      <div class="modal" id="purchaseModal">
        <div class="modal-header">
          <h3 id="purchaseModalTitle">Confirm Purchase</h3>
          <button class="modal-close" id="purchaseModalClose">√ó</button>
        </div>
        <div class="modal-content">
          <div class="purchase-preview" id="purchasePreview">
            <!-- Item preview -->
          </div>
          <div class="purchase-message" id="purchaseMessage">
            <!-- Encouraging message -->
          </div>
          <div class="purchase-cost" id="purchaseCost">
            <!-- Cost display -->
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn secondary" id="purchaseCancelBtn">Cancel</button>
          <button class="btn primary" id="purchaseConfirmBtn">Purchase</button>
        </div>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>
  </div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  window.SUPABASE_URL  = "https://guzdovkwgzgzdnswuoou.supabase.co";
  window.SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd1emRvdmt3Z3pnemRuc3d1b291Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NjQ1NTUsImV4cCI6MjA3MzU0MDU1NX0.MzbKYe9Icdss4qo7FctN-OAb_hzEBhrr0Gi8ZfkbyJc";
</script>
<script src="AddyApp.js"></script>
<script src="customization-store.js"></script>

<!-- Forgot Password trigger near the Sign In button -->
<script>
  // ◊û◊ï◊°◊ô◊£ ◊ê◊™ ◊õ◊§◊™◊ï◊® "Forgot password?" ◊ú◊ô◊ì ◊õ◊§◊™◊ï◊® Sign In ◊ê◊ù ◊î◊ï◊ê ◊ß◊ô◊ô◊ù ◊ë◊ì◊£
  document.addEventListener('DOMContentLoaded', () => {
    const topbar = document.querySelector('.setup-topbar');
    if (topbar && !document.getElementById('forgotPwdBtn')) {
      const btn = document.createElement('button');
      btn.id = 'forgotPwdBtn';
      btn.className = 'btn btn-ghost btn-sm';
      btn.textContent = 'Forgot password?';
      topbar.appendChild(btn);
    }
  });
</script>

<!-- === Forgot Password: Request Email Modal === -->
<div id="fpw-modal-email" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="fpwEmailTitle">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="fpwEmailTitle">Reset your password</h3>
      <button class="modal-close" data-close="#fpw-modal-email">√ó</button>
    </div>
    <div class="modal-form">
      <p class="modal-desc">Enter the email you used for Addy. We‚Äôll send you a secure reset link.</p>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input id="fpwEmail" type="email" class="form-control" placeholder="you@example.com" required>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" data-close="#fpw-modal-email">Cancel</button>
        <button id="fpwSendBtn" class="btn btn-primary">Send reset link</button>
      </div>
      <p id="fpwError" class="small-hint" style="color:#b42318;display:none;margin-top:8px;"></p>
    </div>
  </div>
</div>

<!-- === Forgot Password: Link Sent Modal === -->
<div id="fpw-modal-sent" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="fpwSentTitle">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="fpwSentTitle">Check your inbox</h3>
      <button class="modal-close" data-close="#fpw-modal-sent">√ó</button>
    </div>
    <div class="modal-form">
      <p class="modal-desc">
        We sent a secure link to <span id="fpwSentEmail" style="font-weight:600;"></span>.<br>
        Open it to choose a new password. If you don‚Äôt see it, check Spam/Promotions.
      </p>
      <div class="modal-actions">
        <button class="btn btn-primary" data-close="#fpw-modal-sent">Got it</button>
      </div>
    </div>
  </div>
</div>
</body>
</html>